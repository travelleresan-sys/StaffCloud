{% extends "base.html" %}

{% block title %}労働条件変更通知書作成 - StaffCloud{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="h2 mb-2">
                        <i class="bi bi-arrow-repeat me-2"></i>労働条件変更通知書作成
                    </h1>
                    <p class="text-muted mb-0">従業員の労働条件変更通知書を作成します</p>
                </div>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('company_submissions') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>戻る
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 労働条件変更通知書作成フォーム -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-file-earmark-arrow-up me-2"></i>労働条件変更通知書作成
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('create_working_conditions_change') }}">
                        <!-- 従業員選択 -->
                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="use_existing_employee" onchange="toggleEmployeeInput()">
                                    <label class="form-check-label" for="use_existing_employee">
                                        既存従業員から選択する
                                    </label>
                                </div>
                                <select class="form-select" id="employee_id" name="employee_id" disabled onchange="loadEmployeeData(this.value)">
                                    <option value="">従業員を選択してください</option>
                                    {% for employee in employees %}
                                        <option value="{{ employee.id }}" 
                                                data-name="{{ employee.name }}"
                                                data-position="{{ employee.position or '' }}"
                                                data-department="{{ employee.department or '' }}"
                                                data-salary="{{ employee.base_salary or '' }}">
                                            {{ employee.name }} ({{ employee.id }})
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- 従業員名（手入力） -->
                            <div class="col-12 col-md-6 mb-3">
                                <label for="employee_name" class="form-label">従業員名 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="employee_name" name="employee_name" required>
                            </div>
                        </div>

                        <!-- 変更基本情報 -->
                        <div class="row">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="bi bi-calendar-event me-2"></i>変更基本情報
                                </h6>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label for="change_date" class="form-label">変更実施日 <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="change_date" name="change_date" required>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="change_reason" class="form-label">変更理由 <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="change_reason" name="change_reason" rows="2" required
                                          placeholder="例：組織改編、昇進・昇格、業務拡大等"></textarea>
                            </div>
                        </div>

                        <!-- 変更項目 -->
                        <div class="row">
                            <div class="col-12">
                                <h6 class="text-warning mb-3">
                                    <i class="bi bi-arrow-left-right me-2"></i>変更項目
                                </h6>
                                <p class="text-muted small mb-3">変更のある項目のみ入力してください。変更前・変更後の少なくとも一方を入力してください。</p>
                            </div>

                            <!-- 職種・役職 -->
                            <div class="col-12 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">職種・役職</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="old_position" class="form-label">変更前</label>
                                                <input type="text" class="form-control" id="old_position" name="old_position" 
                                                       placeholder="例：営業職">
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="new_position" class="form-label">変更後</label>
                                                <input type="text" class="form-control" id="new_position" name="new_position" 
                                                       placeholder="例：営業主任">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 所属部署 -->
                            <div class="col-12 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">所属部署</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="old_department" class="form-label">変更前</label>
                                                <input type="text" class="form-control" id="old_department" name="old_department" 
                                                       placeholder="例：営業部">
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="new_department" class="form-label">変更後</label>
                                                <input type="text" class="form-control" id="new_department" name="new_department" 
                                                       placeholder="例：営業1部">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 勤務地 -->
                            <div class="col-12 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">勤務地</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="old_work_location" class="form-label">変更前</label>
                                                <input type="text" class="form-control" id="old_work_location" name="old_work_location" 
                                                       placeholder="例：東京本社">
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="new_work_location" class="form-label">変更後</label>
                                                <input type="text" class="form-control" id="new_work_location" name="new_work_location" 
                                                       placeholder="例：大阪支店">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 基本給 -->
                            <div class="col-12 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">基本給</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="old_salary" class="form-label">変更前（円）</label>
                                                <input type="number" class="form-control" id="old_salary" name="old_salary" 
                                                       placeholder="250000" min="0">
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="new_salary" class="form-label">変更後（円）</label>
                                                <input type="number" class="form-control" id="new_salary" name="new_salary" 
                                                       placeholder="300000" min="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 労働時間 -->
                            <div class="col-12 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">労働時間</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="old_work_hours" class="form-label">変更前</label>
                                                <input type="text" class="form-control" id="old_work_hours" name="old_work_hours" 
                                                       placeholder="例：09:00-18:00">
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="new_work_hours" class="form-label">変更後</label>
                                                <input type="text" class="form-control" id="new_work_hours" name="new_work_hours" 
                                                       placeholder="例：10:00-19:00">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 勤務日 -->
                            <div class="col-12 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">勤務日</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="old_work_days" class="form-label">変更前</label>
                                                <input type="text" class="form-control" id="old_work_days" name="old_work_days" 
                                                       placeholder="例：月-金">
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="new_work_days" class="form-label">変更後</label>
                                                <input type="text" class="form-control" id="new_work_days" name="new_work_days" 
                                                       placeholder="例：月-土">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- アクションボタン -->
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-secondary me-2" onclick="window.history.back()">
                                <i class="bi bi-x-circle me-1"></i>キャンセル
                            </button>
                            <button type="submit" class="btn btn-warning">
                                <i class="bi bi-file-earmark-arrow-up me-1"></i>労働条件変更通知書作成
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleEmployeeInput() {
    const checkbox = document.getElementById('use_existing_employee');
    const select = document.getElementById('employee_id');
    const nameField = document.getElementById('employee_name');
    
    if (checkbox.checked) {
        select.disabled = false;
        nameField.readOnly = true;
    } else {
        select.disabled = true;
        select.value = '';
        nameField.readOnly = false;
        // Clear all fields when unchecking
        clearEmployeeFields();
    }
}

function loadEmployeeData(employeeId) {
    const select = document.getElementById('employee_id');
    const option = select.querySelector(`option[value="${employeeId}"]`);
    
    if (option && document.getElementById('use_existing_employee').checked) {
        document.getElementById('employee_name').value = option.dataset.name || '';
        document.getElementById('old_position').value = option.dataset.position || '';
        document.getElementById('old_department').value = option.dataset.department || '';
        document.getElementById('old_salary').value = option.dataset.salary || '';
    }
}

function clearEmployeeFields() {
    document.getElementById('employee_name').value = '';
    document.getElementById('old_position').value = '';
    document.getElementById('old_department').value = '';
    document.getElementById('old_salary').value = '';
}
</script>
{% endblock %}