{% extends "base.html" %}

{% block title %}管理者ダッシュボード - StaffCloud{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="text-center">
                <h1 class="h2 mb-2">
                    <i class="bi bi-speedometer2 me-2"></i>管理者ダッシュボード
                </h1>
                <p class="text-muted mb-0">
                    {% if current_user.role == 'general_affairs' %}総務事務管理機能{% elif current_user.role == 'hr_affairs' %}人事事務管理機能{% else %}統合管理機能{% endif %}
                </p>
            </div>
        </div>
    </div>

    <!-- 管理機能パネル -->
    <div class="row g-4">
        <!-- 1. スタッフ管理パネル（共通） -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-dark">
                <div class="card-header bg-dark bg-opacity-10">
                    <h5 class="card-title mb-0 text-dark">
                        <i class="bi bi-people me-2"></i>スタッフ管理
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-people-fill display-4 text-dark mb-3"></i>
                    <p class="card-text flex-grow-1">
                        従業員情報の管理、追加、編集を行います。
                    </p>
                    <div class="mt-auto">
                        <div class="btn-group-vertical d-grid gap-2">
                            <button type="button" class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#staffListModal">
                                <i class="bi bi-table me-2"></i>スタッフ一覧
                            </button>
                            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addStaffModal">
                                <i class="bi bi-person-plus me-2"></i>新規追加
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if current_user.role in ['admin', 'hr_affairs'] %}
        <!-- 2. 年休管理 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-primary">
                <div class="card-header bg-primary bg-opacity-10">
                    <h5 class="card-title mb-0 text-primary">
                        <i class="bi bi-calendar-check me-2"></i>年休管理
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-calendar-check display-4 text-primary mb-3"></i>
                    <p class="card-text flex-grow-1">
                        従業員の年次有給休暇の管理と付与を行います。
                    </p>
                    <a href="{{ url_for('leave_management') }}" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-calendar-check me-2"></i>管理画面を開く
                    </a>
                </div>
            </div>
        </div>

        <!-- 3. 申請管理 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-warning">
                <div class="card-header bg-warning bg-opacity-10">
                    <h5 class="card-title mb-0 text-warning">
                        <i class="bi bi-clipboard-check me-2"></i>申請管理
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-clipboard-check display-4 text-warning mb-3"></i>
                    <p class="card-text flex-grow-1">
                        休暇申請や個人情報変更申請の承認・却下を行います。
                    </p>
                    <a href="{{ url_for('admin_requests') }}" class="btn btn-warning btn-lg w-100">
                        <i class="bi bi-clipboard-check me-2"></i>申請を確認
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- 4. 各種届出 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-danger">
                <div class="card-header bg-danger bg-opacity-10">
                    <h5 class="card-title mb-0 text-danger">
                        <i class="bi bi-file-earmark-text me-2"></i>各種届出
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-file-earmark-text display-4 text-danger mb-3"></i>
                    <p class="card-text flex-grow-1">
                        36協定、法定休日、入退社届、各種変更届等の労務管理届出を処理します。
                    </p>
                    <div class="mt-auto">
                        <a href="{{ url_for('company_submissions') }}" class="btn btn-danger btn-lg w-100">
                            <i class="bi bi-file-earmark-text me-2"></i>届出管理
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {% if current_user.role in ['admin', 'general_affairs'] %}
        <!-- 5. カレンダー管理 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-success">
                <div class="card-header bg-success bg-opacity-10">
                    <h5 class="card-title mb-0 text-success">
                        <i class="bi bi-calendar3 me-2"></i>カレンダー管理
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-calendar3 display-4 text-success mb-3"></i>
                    <p class="card-text flex-grow-1">
                        会社イベント、休日、重要日程の管理を行います。
                    </p>
                    <a href="{{ url_for('company_calendar') }}" class="btn btn-success btn-lg w-100">
                        <i class="bi bi-calendar3 me-2"></i>管理画面を開く
                    </a>
                </div>
            </div>
        </div>

        <!-- 6. カレンダー表示 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-info">
                <div class="card-header bg-info bg-opacity-10">
                    <h5 class="card-title mb-0 text-info">
                        <i class="bi bi-calendar-month me-2"></i>カレンダー表示
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-calendar-month display-4 text-info mb-3"></i>
                    <p class="card-text flex-grow-1">
                        年間カレンダーの確認と印刷用表示を行います。
                    </p>
                    <a href="{{ url_for('calendar_view') }}" class="btn btn-info btn-lg w-100">
                        <i class="bi bi-calendar-month me-2"></i>カレンダーを表示
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        {% if current_user.role in ['admin', 'hr_affairs'] %}
        <!-- 7. 人事評価 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-info">
                <div class="card-header bg-info bg-opacity-10">
                    <h5 class="card-title mb-0 text-info">
                        <i class="bi bi-graph-up me-2"></i>人事評価
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-graph-up display-4 text-info mb-3"></i>
                    <p class="card-text flex-grow-1">
                        従業員の人事評価と査定管理を行います。
                    </p>
                    <a href="{{ url_for('performance_evaluation') }}" class="btn btn-info btn-lg w-100">
                        <i class="bi bi-graph-up me-2"></i>評価管理
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        {% if current_user.role in ['admin', 'general_affairs'] %}
        <!-- 8. 企業情報管理 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-primary">
                <div class="card-header bg-primary bg-opacity-10">
                    <h5 class="card-title mb-0 text-primary">
                        <i class="bi bi-building me-2"></i>企業情報管理
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-building display-4 text-primary mb-3"></i>
                    <p class="card-text flex-grow-1">
                        企業基本情報の管理と設定を行います。
                    </p>
                    <a href="{{ url_for('company_info') }}" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-building me-2"></i>企業情報管理
                    </a>
                </div>
            </div>
        </div>

        <!-- 9. 組織図 -->
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-secondary">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="card-title mb-0 text-secondary">
                        <i class="bi bi-diagram-3 me-2"></i>組織図
                    </h5>
                </div>
                <div class="card-body text-center d-flex flex-column">
                    <i class="bi bi-diagram-3 display-4 text-secondary mb-3"></i>
                    <p class="card-text flex-grow-1">
                        組織構造の管理と組織図の作成・更新を行います。
                    </p>
                    <a href="{{ url_for('organization_chart') }}" class="btn btn-secondary btn-lg w-100">
                        <i class="bi bi-diagram-3 me-2"></i>組織図を開く
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- スタッフ一覧モーダル -->
<div class="modal fade" id="staffListModal" tabindex="-1" aria-labelledby="staffListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staffListModalLabel">
                    <i class="bi bi-people me-2"></i>スタッフ一覧
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if employees %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">顔写真</th>
                                <th scope="col">氏名</th>
                                <th scope="col">国籍</th>
                                <th scope="col">生年月日</th>
                                <th scope="col">性別</th>
                                <th scope="col">入社年月日</th>
                                <th scope="col">電話番号</th>
                                <th scope="col">住所</th>
                                <th scope="col">役職</th>
                                <th scope="col">部署</th>
                                <th scope="col">在留カード期限</th>
                                <th scope="col">自動車保険満了日</th>
                                <th scope="col">在籍状況</th>
                                <th scope="col">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for employee in employees %}
                            <tr class="{% if employee.is_bg_row %}table-danger{% endif %}" {% if employee.is_bg_row %}style="--bs-table-accent-bg: var(--bs-danger-bg-subtle); --bs-table-bg: var(--bs-danger-bg-subtle);"{% endif %}>
                                <td><span class="badge bg-secondary">{{ employee.id }}</span></td>
                                <td>
                                    {% if employee.photo_filename %}
                                        <img src="{{ url_for('static', filename='uploads/' + employee.photo_filename) }}" 
                                             alt="{{ employee.name }}の写真" 
                                             class="img-thumbnail" 
                                             style="width: 40px; height: 40px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-light d-flex align-items-center justify-content-center" 
                                             style="width: 40px; height: 40px; border-radius: 0.375rem;">
                                            <i class="bi bi-person text-muted"></i>
                                        </div>
                                    {% endif %}
                                </td>
                                <td>{{ employee.name }}</td>
                                <td>{{ employee.nationality or '-' }}</td>
                                <td>{{ employee.birth_date.strftime('%Y年%m月%d日') if employee.birth_date else '-' }}</td>
                                <td>{{ employee.gender or '-' }}</td>
                                <td>{{ employee.join_date.strftime('%Y年%m月%d日') }}</td>
                                <td>{{ employee.phone_number or '-' }}</td>
                                <td>
                                    {% if employee.address %}
                                        <span class="text-truncate d-inline-block" style="max-width: 100px;" title="{{ employee.address }}">
                                            {{ employee.address }}
                                        </span>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>{{ employee.position or '-' }}</td>
                                <td>{{ employee.department or '-' }}</td>
                                <td>
                                    {% if employee.residence_card_expiry %}
                                        <span class="{% if employee.residence_card_level in ['warn60','warn30','expired'] %}text-danger fw-bold{% endif %}">
                                            {{ employee.residence_card_expiry.strftime('%Y年%m月%d日') }}
                                        </span>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.car_insurance_expiry %}
                                        <span class="{% if employee.car_insurance_level in ['warn60','warn30','expired'] %}text-danger fw-bold{% endif %}">
                                            {{ employee.car_insurance_expiry.strftime('%Y年%m月%d日') }}
                                        </span>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.status == '在籍中' %}
                                        <span class="badge bg-success">在籍中</span>
                                    {% else %}
                                        <span class="badge bg-secondary">退職済</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="{{ url_for('employee_detail', employee_id=employee.id) }}" class="btn btn-outline-info btn-sm">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <a href="{{ url_for('edit_employee', employee_id=employee.id) }}" class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a href="{{ url_for('delete_employee', employee_id=employee.id) }}" class="btn btn-outline-danger btn-sm"
                                           onclick="return confirm('本当にこの従業員を削除しますか？')">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-inbox display-1 text-muted"></i>
                    <p class="lead text-muted mt-3">従業員はまだ登録されていません。</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- 新規スタッフ追加モーダル -->
<div class="modal fade" id="addStaffModal" tabindex="-1" aria-labelledby="addStaffModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addStaffModalLabel">
                    <i class="bi bi-person-plus me-2"></i>新しいスタッフを追加
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{{ url_for('add_employee') }}" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">氏名 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="join_date" class="form-label">入社年月日 <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="join_date" name="join_date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="birth_date" class="form-label">生年月日</label>
                            <input type="date" class="form-control" id="birth_date" name="birth_date">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="gender" class="form-label">性別</label>
                            <select class="form-select" id="gender" name="gender">
                                <option value="">選択してください</option>
                                <option value="男性">男性</option>
                                <option value="女性">女性</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="phone_number" class="form-label">電話番号</label>
                            <input type="tel" class="form-control" id="phone_number" name="phone_number" placeholder="例: 090-1234-5678">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="status" class="form-label">在籍状況</label>
                            <select class="form-select" id="status" name="status" required>
                                <option value="在籍中">在籍中</option>
                                <option value="退職済">退職済</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="nationality" class="form-label">国籍</label>
                            <select class="form-select" id="nationality" name="nationality">
                                <option value="">選択してください</option>
                                <optgroup label="アジア・オセアニア">
                                    <option value="日本">日本</option>
                                    <option value="中国">中国</option>
                                    <option value="韓国">韓国</option>
                                    <option value="モンゴル">モンゴル</option>
                                    <option value="ベトナム">ベトナム</option>
                                    <option value="ネパール">ネパール</option>
                                    <option value="フィリピン">フィリピン</option>
                                    <option value="インド">インド</option>
                                    <option value="インドネシア">インドネシア</option>
                                    <option value="ミャンマー">ミャンマー</option>
                                    <option value="カンボジア">カンボジア</option>
                                    <option value="ラオス">ラオス</option>
                                    <option value="タイ">タイ</option>
                                    <option value="マレーシア">マレーシア</option>
                                    <option value="シンガポール">シンガポール</option>
                                    <option value="バングラデシュ">バングラデシュ</option>
                                    <option value="スリランカ">スリランカ</option>
                                    <option value="パキスタン">パキスタン</option>
                                    <option value="ウズベキスタン">ウズベキスタン</option>
                                    <option value="カザフスタン">カザフスタン</option>
                                    <option value="キルギス">キルギス</option>
                                    <option value="タジキスタン">タジキスタン</option>
                                    <option value="トルクメニスタン">トルクメニスタン</option>
                                    <option value="アフガニスタン">アフガニスタン</option>
                                    <option value="オーストラリア">オーストラリア</option>
                                    <option value="ニュージーランド">ニュージーランド</option>
                                </optgroup>
                                <optgroup label="中東・アフリカ">
                                    <option value="イラン">イラン</option>
                                    <option value="イラク">イラク</option>
                                    <option value="サウジアラビア">サウジアラビア</option>
                                    <option value="UAE">UAE</option>
                                    <option value="クウェート">クウェート</option>
                                    <option value="カタール">カタール</option>
                                    <option value="オマーン">オマーン</option>
                                    <option value="バーレーン">バーレーン</option>
                                    <option value="ヨルダン">ヨルダン</option>
                                    <option value="レバノン">レバノン</option>
                                    <option value="シリア">シリア</option>
                                    <option value="イスラエル">イスラエル</option>
                                    <option value="トルコ">トルコ</option>
                                    <option value="エジプト">エジプト</option>
                                    <option value="モロッコ">モロッコ</option>
                                    <option value="チュニジア">チュニジア</option>
                                    <option value="アルジェリア">アルジェリア</option>
                                    <option value="リビア">リビア</option>
                                    <option value="スーダン">スーダン</option>
                                    <option value="エチオピア">エチオピア</option>
                                    <option value="ケニア">ケニア</option>
                                    <option value="ナイジェリア">ナイジェリア</option>
                                    <option value="ガーナ">ガーナ</option>
                                    <option value="セネガル">セネガル</option>
                                    <option value="コートジボワール">コートジボワール</option>
                                    <option value="カメルーン">カメルーン</option>
                                    <option value="コンゴ民主共和国">コンゴ民主共和国</option>
                                    <option value="南アフリカ">南アフリカ</option>
                                </optgroup>
                                <optgroup label="北米・中南米">
                                    <option value="米国">米国</option>
                                    <option value="カナダ">カナダ</option>
                                    <option value="メキシコ">メキシコ</option>
                                    <option value="ブラジル">ブラジル</option>
                                    <option value="アルゼンチン">アルゼンチン</option>
                                    <option value="チリ">チリ</option>
                                    <option value="ペルー">ペルー</option>
                                    <option value="コロンビア">コロンビア</option>
                                    <option value="ベネズエラ">ベネズエラ</option>
                                    <option value="エクアドル">エクアドル</option>
                                    <option value="ボリビア">ボリビア</option>
                                    <option value="パラグアイ">パラグアイ</option>
                                    <option value="ウルグアイ">ウルグアイ</option>
                                </optgroup>
                                <optgroup label="ヨーロッパ">
                                    <option value="イギリス">イギリス</option>
                                    <option value="フランス">フランス</option>
                                    <option value="ドイツ">ドイツ</option>
                                    <option value="イタリア">イタリア</option>
                                    <option value="スペイン">スペイン</option>
                                    <option value="ポルトガル">ポルトガル</option>
                                    <option value="オランダ">オランダ</option>
                                    <option value="ベルギー">ベルギー</option>
                                    <option value="スイス">スイス</option>
                                    <option value="オーストリア">オーストリア</option>
                                    <option value="スウェーデン">スウェーデン</option>
                                    <option value="ノルウェー">ノルウェー</option>
                                    <option value="デンマーク">デンマーク</option>
                                    <option value="フィンランド">フィンランド</option>
                                    <option value="ポーランド">ポーランド</option>
                                    <option value="チェコ">チェコ</option>
                                    <option value="スロバキア">スロバキア</option>
                                    <option value="ハンガリー">ハンガリー</option>
                                    <option value="ルーマニア">ルーマニア</option>
                                    <option value="ブルガリア">ブルガリア</option>
                                    <option value="クロアチア">クロアチア</option>
                                    <option value="スロベニア">スロベニア</option>
                                    <option value="セルビア">セルビア</option>
                                    <option value="ボスニア・ヘルツェゴビナ">ボスニア・ヘルツェゴビナ</option>
                                    <option value="モンテネグロ">モンテネグロ</option>
                                    <option value="北マケドニア">北マケドニア</option>
                                    <option value="アルバニア">アルバニア</option>
                                    <option value="ギリシャ">ギリシャ</option>
                                    <option value="ウクライナ">ウクライナ</option>
                                    <option value="ベラルーシ">ベラルーシ</option>
                                    <option value="リトアニア">リトアニア</option>
                                    <option value="ラトビア">ラトビア</option>
                                    <option value="エストニア">エストニア</option>
                                    <option value="ロシア">ロシア</option>
                                    <option value="ジョージア">ジョージア</option>
                                    <option value="アルメニア">アルメニア</option>
                                    <option value="アゼルバイジャン">アゼルバイジャン</option>
                                </optgroup>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="residence_card_expiry" class="form-label">在留カード期限</label>
                            <input type="date" class="form-control" id="residence_card_expiry" name="residence_card_expiry">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="car_insurance_expiry" class="form-label">自動車保険満了日</label>
                            <input type="date" class="form-control" id="car_insurance_expiry" name="car_insurance_expiry">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="photo" class="form-label">顔写真</label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="photo" name="photo" accept="image/*" onchange="previewImage(this, 'photo-preview')">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearPhotoPreview('photo', 'photo-preview')">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                            <div class="form-text">JPG、PNG形式の画像をアップロードしてください</div>
                            <!-- サムネイル表示エリア -->
                            <div id="photo-preview" class="mt-2" style="display: none;">
                                <img id="photo-preview-img" src="" alt="プレビュー" 
                                     class="img-thumbnail" 
                                     style="width: 100px; height: 100px; object-fit: cover;">
                                <p class="form-text mt-1">アップロード予定の画像</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="residence_card_file" class="form-label">在留カード画像・PDF</label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="residence_card_file" name="residence_card_file" accept="image/*,.pdf" onchange="previewResidenceCard(this)">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearResidenceCardPreview()">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                            <div class="form-text">画像またはPDFファイルをアップロードしてください</div>
                            <!-- ファイル名表示エリア -->
                            <div id="residence-card-preview" class="mt-2" style="display: none;">
                                <div class="alert alert-info py-2">
                                    <i class="bi bi-file-earmark me-2"></i>
                                    <span id="residence-card-filename"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="car_insurance_file" class="form-label">自動車保険証画像・PDF</label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="car_insurance_file" name="car_insurance_file" accept="image/*,.pdf" onchange="previewCarInsurance(this)">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearCarInsurancePreview()">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                            <div class="form-text">画像またはPDFファイルをアップロードしてください</div>
                            <!-- ファイル名表示エリア -->
                            <div id="car-insurance-preview" class="mt-2" style="display: none;">
                                <div class="alert alert-info py-2">
                                    <i class="bi bi-file-earmark me-2"></i>
                                    <span id="car-insurance-filename"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- HR情報 (管理者専用) -->
                    <div class="row">
                        <div class="col-12 mb-3">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="bi bi-briefcase me-2"></i>人事情報
                                <small class="text-muted">(管理者のみ表示)</small>
                            </h6>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="position" class="form-label">役職</label>
                            <input type="text" class="form-control" id="position" name="position" placeholder="例: 主任、課長">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="department" class="form-label">部署</label>
                            <select class="form-select" id="department" name="department">
                                <option value="">選択してください</option>
                                <option value="営業部">営業部</option>
                                <option value="マーケティング部">マーケティング部</option>
                                <option value="開発部">開発部</option>
                                <option value="技術部">技術部</option>
                                <option value="製造部">製造部</option>
                                <option value="品質保証部">品質保証部</option>
                                <option value="人事部">人事部</option>
                                <option value="総務部">総務部</option>
                                <option value="経理部">経理部</option>
                                <option value="法務部">法務部</option>
                                <option value="情報システム部">情報システム部</option>
                                <option value="カスタマーサポート部">カスタマーサポート部</option>
                                <option value="購買部">購買部</option>
                                <option value="物流部">物流部</option>
                                <option value="企画部">企画部</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="hire_type" class="form-label">雇用形態</label>
                            <select class="form-select" id="hire_type" name="hire_type">
                                <option value="">選択してください</option>
                                <option value="正社員">正社員</option>
                                <option value="契約社員">契約社員</option>
                                <option value="派遣社員">派遣社員</option>
                                <option value="パート・アルバイト">パート・アルバイト</option>
                                <option value="業務委託">業務委託</option>
                                <option value="インターン">インターン</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="work_history" class="form-label">経歴</label>
                            <textarea class="form-control" id="work_history" name="work_history" rows="3" placeholder="職歴や経験について記載"></textarea>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="skills" class="form-label">スキル</label>
                            <textarea class="form-control" id="skills" name="skills" rows="3" placeholder="技術スキル、言語能力など"></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="qualifications" class="form-label">資格</label>
                            <textarea class="form-control" id="qualifications" name="qualifications" rows="3" placeholder="保有資格、免許など"></textarea>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="salary_grade" class="form-label">給与等級</label>
                            <select class="form-select" id="salary_grade" name="salary_grade">
                                <option value="">選択してください</option>
                                <option value="S1">S1</option>
                                <option value="S2">S2</option>
                                <option value="S3">S3</option>
                                <option value="A1">A1</option>
                                <option value="A2">A2</option>
                                <option value="A3">A3</option>
                                <option value="B1">B1</option>
                                <option value="B2">B2</option>
                                <option value="B3">B3</option>
                                <option value="C1">C1</option>
                                <option value="C2">C2</option>
                                <option value="C3">C3</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <label for="address" class="form-label">住所</label>
                            <textarea class="form-control" id="address" name="address" rows="3" placeholder="例: 東京都渋谷区..."></textarea>
                        </div>
                        <div class="col-12 mb-3">
                            <label for="address" class="form-label">住所</label>
                            <textarea class="form-control" id="address" name="address" rows="2" placeholder="例: 東京都渋谷区..."></textarea>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">キャンセル</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>追加
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function previewImage(input, previewId) {
        const preview = document.getElementById(previewId);
        const img = document.getElementById(previewId + '-img');
        
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                img.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.style.display = 'none';
        }
    }
    
    function clearPhotoPreview(inputId, previewId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        
        input.value = '';
        preview.style.display = 'none';
    }
    
    function previewResidenceCard(input) {
        const preview = document.getElementById('residence-card-preview');
        const filename = document.getElementById('residence-card-filename');
        
        if (input.files && input.files[0]) {
            preview.style.display = 'block';
            filename.textContent = input.files[0].name;
        } else {
            preview.style.display = 'none';
        }
    }
    
    function clearResidenceCardPreview() {
        const input = document.getElementById('residence_card_file');
        const preview = document.getElementById('residence-card-preview');
        
        input.value = '';
        preview.style.display = 'none';
    }
    
    function previewCarInsurance(input) {
        const preview = document.getElementById('car-insurance-preview');
        const filename = document.getElementById('car-insurance-filename');
        
        if (input.files && input.files[0]) {
            preview.style.display = 'block';
            filename.textContent = input.files[0].name;
        } else {
            preview.style.display = 'none';
        }
    }
    
    function clearCarInsurancePreview() {
        const input = document.getElementById('car_insurance_file');
        const preview = document.getElementById('car-insurance-preview');
        
        input.value = '';
        preview.style.display = 'none';
    }
</script>

{% endblock %}