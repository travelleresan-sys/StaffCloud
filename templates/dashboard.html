{% extends "base.html" %}

{% block title %}管理者ダッシュボード - 従業員管理システム{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="h3 mb-0">
                <i class="bi bi-speedometer2 me-2"></i>管理者ダッシュボード
            </h1>
            <div class="btn-group" role="group">
                <a href="{{ url_for('leave_management') }}" class="btn btn-outline-primary">
                    <i class="bi bi-calendar-check me-1"></i>年休管理
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title mb-0">
                    <i class="bi bi-table me-2"></i>従業員一覧
                </h2>
            </div>
            <div class="card-body">
                {% if employees %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">顔写真</th>
                                <th scope="col">氏名</th>
                                <th scope="col">国籍</th>
                                <th scope="col">生年月日</th>
                                <th scope="col">性別</th>
                                <th scope="col">入社年月日</th>
                                <th scope="col">電話番号</th>
                                <th scope="col">住所</th>
                                <th scope="col">在留カード期限</th>
                                <th scope="col">自動車保険満了日</th>
                                <th scope="col">在籍状況</th>
                                <th scope="col">操作</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
                            <tr class="{% if employee.is_bg_row %}table-danger{% endif %}" {% if employee.is_bg_row %}style="--bs-table-accent-bg: var(--bs-danger-bg-subtle); --bs-table-bg: var(--bs-danger-bg-subtle);"{% endif %}>
                                <td><span class="badge bg-secondary">{{ employee.id }}</span></td>
                                <td>
                                    {% if employee.photo_filename %}
                                        <img src="{{ url_for('static', filename='uploads/' + employee.photo_filename) }}" 
                                             alt="{{ employee.name }}の写真" 
                                             class="img-thumbnail" 
                                             style="width: 50px; height: 50px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-light d-flex align-items-center justify-content-center" 
                                             style="width: 50px; height: 50px; border-radius: 0.375rem;">
                                            <i class="bi bi-person text-muted"></i>
                                        </div>
                                    {% endif %}
                                </td>
                <td>{{ employee.name }}</td>
                                <td>
                                    {% if employee.nationality %}
                                        {{ employee.nationality }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.birth_date %}
                                        {{ employee.birth_date.strftime('%Y年%m月%d日') }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.gender %}
                                        {{ employee.gender }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>{{ employee.join_date.strftime('%Y年%m月%d日') }}</td>
                                <td>
                                    {% if employee.phone_number %}
                                        {{ employee.phone_number }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.address %}
                                        <span class="text-truncate d-inline-block" style="max-width: 150px;" title="{{ employee.address }}">
                                            {{ employee.address }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.residence_card_expiry %}
                                        <span class="{% if employee.residence_card_level in ['warn60','warn30','expired'] %}text-danger fw-bold{% endif %}">
                                            {{ employee.residence_card_expiry.strftime('%Y年%m月%d日') }}
                                        </span>
                                        {% if employee.residence_card_level in ['warn30','expired'] %}
                                            <i class="bi bi-exclamation-triangle-fill text-danger ms-1" title="期限が迫っています"></i>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.car_insurance_expiry %}
                                        <span class="{% if employee.car_insurance_level in ['warn60','warn30','expired'] %}text-danger fw-bold{% endif %}">
                                            {{ employee.car_insurance_expiry.strftime('%Y年%m月%d日') }}
                                        </span>
                                        {% if employee.car_insurance_level in ['warn30','expired'] %}
                                            <i class="bi bi-exclamation-triangle-fill text-danger ms-1" title="期限が迫っています"></i>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.status == '在籍中' %}
                                        <span class="badge bg-success">在籍中</span>
                                    {% else %}
                                        <span class="badge bg-secondary">退職済</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="{{ url_for('edit_employee', employee_id=employee.id) }}" 
                                           class="btn btn-outline-primary">
                                            <i class="bi bi-pencil me-1"></i>編集
                                        </a>
                                        <a href="{{ url_for('delete_employee', employee_id=employee.id) }}" 
                                           class="btn btn-outline-danger"
                                           onclick="return confirm('本当にこの従業員を削除しますか？')">
                                            <i class="bi bi-trash me-1"></i>削除
                                        </a>
                                    </div>
                                </td>
            </tr>
            {% else %}
            <tr>
                                <td colspan="13">従業員はまだ登録されていません。</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-inbox display-1 text-muted"></i>
                    <p class="lead text-muted mt-3">従業員はまだ登録されていません。</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">
                    <i class="bi bi-person-plus me-2"></i>新しい従業員を追加
                </h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_employee') }}" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="name" class="form-label">氏名</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="birth_date" class="form-label">生年月日</label>
                            <input type="date" class="form-control" id="birth_date" name="birth_date">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="gender" class="form-label">性別</label>
                            <select class="form-select" id="gender" name="gender">
                                <option value="">選択してください</option>
                                <option value="男性">男性</option>
                                <option value="女性">女性</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="join_date" class="form-label">入社年月日</label>
                            <input type="date" class="form-control" id="join_date" name="join_date" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="phone_number" class="form-label">電話番号</label>
                            <input type="tel" class="form-control" id="phone_number" name="phone_number" placeholder="例: 090-1234-5678">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="status" class="form-label">在籍状況</label>
                            <select class="form-select" id="status" name="status" required>
                                <option value="在籍中">在籍中</option>
                                <option value="退職済">退職済</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="nationality" class="form-label">国籍</label>
                            <select class="form-select" id="nationality" name="nationality">
                                <option value="">選択してください</option>
                                <optgroup label="アジア・オセアニア">
                                    <option value="日本">日本</option>
                                    <option value="中国">中国</option>
                                    <option value="韓国">韓国</option>
                                    <option value="モンゴル">モンゴル</option>
                                    <option value="ベトナム">ベトナム</option>
                                    <option value="ネパール">ネパール</option>
                                    <option value="フィリピン">フィリピン</option>
                                    <option value="インド">インド</option>
                                    <option value="インドネシア">インドネシア</option>
                                    <option value="ミャンマー">ミャンマー</option>
                                    <option value="カンボジア">カンボジア</option>
                                    <option value="ラオス">ラオス</option>
                                    <option value="タイ">タイ</option>
                                    <option value="マレーシア">マレーシア</option>
                                    <option value="シンガポール">シンガポール</option>
                                    <option value="バングラデシュ">バングラデシュ</option>
                                    <option value="スリランカ">スリランカ</option>
                                    <option value="パキスタン">パキスタン</option>
                                    <option value="ウズベキスタン">ウズベキスタン</option>
                                    <option value="カザフスタン">カザフスタン</option>
                                    <option value="キルギス">キルギス</option>
                                    <option value="タジキスタン">タジキスタン</option>
                                    <option value="トルクメニスタン">トルクメニスタン</option>
                                    <option value="アフガニスタン">アフガニスタン</option>
                                    <option value="オーストラリア">オーストラリア</option>
                                    <option value="ニュージーランド">ニュージーランド</option>
                                </optgroup>
                                <optgroup label="中東・アフリカ">
                                    <option value="イラン">イラン</option>
                                    <option value="イラク">イラク</option>
                                    <option value="サウジアラビア">サウジアラビア</option>
                                    <option value="UAE">UAE</option>
                                    <option value="クウェート">クウェート</option>
                                    <option value="カタール">カタール</option>
                                    <option value="オマーン">オマーン</option>
                                    <option value="バーレーン">バーレーン</option>
                                    <option value="ヨルダン">ヨルダン</option>
                                    <option value="レバノン">レバノン</option>
                                    <option value="シリア">シリア</option>
                                    <option value="イスラエル">イスラエル</option>
                                    <option value="トルコ">トルコ</option>
                                    <option value="エジプト">エジプト</option>
                                    <option value="モロッコ">モロッコ</option>
                                    <option value="チュニジア">チュニジア</option>
                                    <option value="アルジェリア">アルジェリア</option>
                                    <option value="リビア">リビア</option>
                                    <option value="スーダン">スーダン</option>
                                    <option value="エチオピア">エチオピア</option>
                                    <option value="ケニア">ケニア</option>
                                    <option value="ナイジェリア">ナイジェリア</option>
                                    <option value="ガーナ">ガーナ</option>
                                    <option value="セネガル">セネガル</option>
                                    <option value="コートジボワール">コートジボワール</option>
                                    <option value="カメルーン">カメルーン</option>
                                    <option value="コンゴ民主共和国">コンゴ民主共和国</option>
                                    <option value="南アフリカ">南アフリカ</option>
                                </optgroup>
                                <optgroup label="北米・中南米">
                                    <option value="米国">米国</option>
                                    <option value="カナダ">カナダ</option>
                                    <option value="メキシコ">メキシコ</option>
                                    <option value="ブラジル">ブラジル</option>
                                    <option value="アルゼンチン">アルゼンチン</option>
                                    <option value="チリ">チリ</option>
                                    <option value="ペルー">ペルー</option>
                                    <option value="コロンビア">コロンビア</option>
                                    <option value="ベネズエラ">ベネズエラ</option>
                                    <option value="エクアドル">エクアドル</option>
                                    <option value="ボリビア">ボリビア</option>
                                    <option value="パラグアイ">パラグアイ</option>
                                    <option value="ウルグアイ">ウルグアイ</option>
                                </optgroup>
                                <optgroup label="ヨーロッパ">
                                    <option value="イギリス">イギリス</option>
                                    <option value="フランス">フランス</option>
                                    <option value="ドイツ">ドイツ</option>
                                    <option value="イタリア">イタリア</option>
                                    <option value="スペイン">スペイン</option>
                                    <option value="ポルトガル">ポルトガル</option>
                                    <option value="オランダ">オランダ</option>
                                    <option value="ベルギー">ベルギー</option>
                                    <option value="スイス">スイス</option>
                                    <option value="オーストリア">オーストリア</option>
                                    <option value="スウェーデン">スウェーデン</option>
                                    <option value="ノルウェー">ノルウェー</option>
                                    <option value="デンマーク">デンマーク</option>
                                    <option value="フィンランド">フィンランド</option>
                                    <option value="ポーランド">ポーランド</option>
                                    <option value="チェコ">チェコ</option>
                                    <option value="スロバキア">スロバキア</option>
                                    <option value="ハンガリー">ハンガリー</option>
                                    <option value="ルーマニア">ルーマニア</option>
                                    <option value="ブルガリア">ブルガリア</option>
                                    <option value="クロアチア">クロアチア</option>
                                    <option value="スロベニア">スロベニア</option>
                                    <option value="セルビア">セルビア</option>
                                    <option value="ボスニア・ヘルツェゴビナ">ボスニア・ヘルツェゴビナ</option>
                                    <option value="モンテネグロ">モンテネグロ</option>
                                    <option value="北マケドニア">北マケドニア</option>
                                    <option value="アルバニア">アルバニア</option>
                                    <option value="ギリシャ">ギリシャ</option>
                                    <option value="ウクライナ">ウクライナ</option>
                                    <option value="ベラルーシ">ベラルーシ</option>
                                    <option value="リトアニア">リトアニア</option>
                                    <option value="ラトビア">ラトビア</option>
                                    <option value="エストニア">エストニア</option>
                                    <option value="ロシア">ロシア</option>
                                    <option value="ジョージア">ジョージア</option>
                                    <option value="アルメニア">アルメニア</option>
                                    <option value="アゼルバイジャン">アゼルバイジャン</option>
                                </optgroup>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="residence_card_expiry" class="form-label">在留カード期限</label>
                            <input type="date" class="form-control" id="residence_card_expiry" name="residence_card_expiry">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="car_insurance_expiry" class="form-label">自動車保険満了日</label>
                            <input type="date" class="form-control" id="car_insurance_expiry" name="car_insurance_expiry">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="photo" class="form-label">顔写真</label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="photo" name="photo" accept="image/*" onchange="previewImage(this, 'photo-preview')">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearPhotoPreview('photo', 'photo-preview')">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                            <div class="form-text">PNG、JPG、JPEG、GIF形式の画像ファイルを選択してください</div>
                            <!-- サムネイル表示エリア -->
                            <div id="photo-preview" class="mt-2" style="display: none;">
                                <img id="photo-preview-img" src="" alt="プレビュー" 
                                     class="img-thumbnail" 
                                     style="width: 100px; height: 100px; object-fit: cover;">
                                <p class="form-text mt-1">アップロード予定の画像</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="address" class="form-label">住所</label>
                            <textarea class="form-control" id="address" name="address" rows="2" placeholder="例: 東京都渋谷区..."></textarea>
                        </div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>従業員を追加
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}