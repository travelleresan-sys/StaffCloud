# 労働時間振り分けロジックの説明

## 現在の実装について

### 1. 基本的な労働時間の分類

システムは以下の3つのカテゴリーに労働時間を分類します：

1. **法定内労働時間（Regular Working Time）**
   - 週40時間以内の労働時間
   - 割増賃金なし（通常賃金）

2. **法定外残業時間（Overtime）**
   - 週40時間を超えた労働時間
   - 25%の割増賃金

3. **法定休日労働時間（Legal Holiday Working Time）**
   - 法定休日（通常は日曜日）の労働時間
   - 35%の割増賃金

### 2. 週40時間制限の適用方法

#### 現在の実装（月曜日起算）
```
月曜日から日曜日を1週間として計算
例：11月4日(月)〜11月10日(日)の週で
- 月〜金：各7.5時間 = 37.5時間（法定内）
- 土：7.5時間（土曜日が会社休日の場合も法定内として扱い、週40時間に含める）
- 日：7.5時間（法定休日なので週40時間計算から除外）

結果：
- 月〜金：37.5時間（法定内）
- 土：2.5時間（法定内）+ 5.0時間（法定外残業）
- 日：7.5時間（法定休日労働）
```

### 3. デバッグログの解釈

ログ例：
```
Processing week starting 2024-11-04, records: 7
  2024-11-04: Regular work 7.5h - included in 40h calculation
  2024-11-05: Regular work 7.5h - included in 40h calculation
  2024-11-06: Regular work 7.5h - included in 40h calculation
  2024-11-07: Regular work 7.5h - included in 40h calculation
  2024-11-08: Regular work 7.5h - included in 40h calculation
  2024-11-09: Legal holiday 7.5h - excluded from 40h calculation
  2024-11-10: Regular work 7.5h - included in 40h calculation
  Week total: 45.0h, Overtime: 5.0h
    Reclassifying 2024-11-10: 7.5h -> Regular 2.5h + Overtime 5.0h
```

**解釈：**
- 11/4(月)〜11/8(金)：各7.5時間 = 37.5時間（法定内）
- 11/9(土)：7.5時間（法定休日として35%割増）
- 11/10(日)：7.5時間を週40時間制限により再分類
  - 2.5時間：法定内（40時間まで）
  - 5.0時間：法定外残業（40時間超過分）

### 4. 重要なポイント

1. **法定休日の扱い**
   - 法定休日（通常は日曜日）の労働は週40時間計算から除外
   - すべて法定休日労働（35%割増）として扱う

2. **週40時間超過分の割り当て**
   - 週の後半（日曜日に近い日）から順に時間外労働に再分類
   - これにより、週の前半の労働は法定内労働として優先的に扱われる

3. **土曜日の扱い**
   - 法定休日でない土曜日は、週40時間計算に含める
   - 会社休日であっても、週40時間を超えない限り法定内労働

### 5. 設定可能な項目

システム管理者は以下を設定できます：
- 各曜日を法定休日にするかどうか
- 祝日を法定休日として扱うかどうか
- 週の起算日（現在は月曜日固定）

## 推奨事項

1. **標準的な運用**
   - 日曜日を法定休日として設定
   - 土曜日は会社休日（法定外休日）として設定
   - 祝日は法定休日として設定

2. **給与計算への影響**
   - 法定内労働：通常賃金
   - 法定外残業：25%割増
   - 法定休日労働：35%割増

この設定により、労働基準法に準拠した正確な給与計算が可能になります。